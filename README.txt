
Vamp Website Layout
-------------------

Most of the site is served through a small Spark Java application,
whose code is found in this repo.  The purpose of this application is
to serve the dynamically generated plugin download page, but for
convenience it is also configured to serve up the static HTML content
(found in the public/ subrepo) and static RDF data (rdf/ subrepo).

This means the Apache front-end server should be configured to pass
everything through to the Spark server on a local port, except for the
forum (PHP to be run by Apache) and the wiki (redirecting to the
SoundSoftware code site, we no longer host a wiki locally).

That is, these are handled by Spark as long as Apache passes / through
to it appropriately:

  /                Static content served through Spark
  /download.html   Dynamic content generated by Spark

But these need to be overridden by Apache before reaching Spark:

  /rdf             Static content served by Apache (plus index pages etc)
  /forum           Dynamic PHP content
  /wiki            Redirect


Outline Apache config
---------------------

<VirtualHost *:80>
	ServerName vamp-plugins.org
	ServerAlias www.vamp-plugins.org 
	
	DocumentRoot /var/www/vamp-plugins.org
	<Directory /var/www/vamp-plugins.org>
		Options None
		AllowOverride None
		Order allow,deny
		Allow from all
                # Permit short cache to speed navigation and assist
                # the HTTP accelerator.  The SMF forum overrides this
		# with its own Expires header.
                ExpiresDefault "access plus 1 minute"
	</Directory>

        <DirectoryMatch "^/.*/\.svn/">
                Order allow,deny
                Deny from all
                Satisfy All
        </DirectoryMatch>

        <DirectoryMatch "^/.*/\.hg/">
                Order allow,deny
                Deny from all
                Satisfy All
        </DirectoryMatch>

	<Directory /var/www/vamp-plugins.org/pre>
		Options +Indexes
	</Directory>

	<Directory /var/www/vamp-plugins.org/forum>
		AddHandler fcgid-script .php
		FCGIWrapper /usr/lib/cgi-bin/php5 .php
		Options +ExecCGI
		Options -MultiViews
	</Directory>

	<Directory /var/www/vamp-plugins.org/rdf>
		AddType application/rdf+xml .rdf
		AddType application/rdf+xml .rdfs
		AddType text/rdf+n3 .n3
		DirectoryIndex vamp.rdf
		Options +FollowSymLinks
		RewriteEngine on
		RewriteBase /rdf
		RewriteRule ^([^/]+)/([^\.]+)$ $1/$2.n3
                ExpiresDefault "access plus 5 minutes"
	</Directory>

	<Directory /var/www/vamp-plugins.org/rdf/plugins>
		Options +Indexes
                ExpiresDefault "access plus 5 minutes"
	</Directory>

	Redirect seeother /wiki http://code.soundsoftware.ac.uk/projects/vamp-p
lugin-sdk/wiki

        <Directory /var/www/vamp-plugins.org/logs>
                AuthUserFile "/var/www/.cannamlogs.htdigest"
                AuthName "Server Usage Statistics"
                AuthType Digest
                Require user cannamlogs
        </Directory>

	ErrorLog /var/log/apache2/error.log

	# Possible values include: debug, info, notice, warn, error, crit,
	# alert, emerg.
	LogLevel warn

	CustomLog /var/log/apache2/vamp-plugins.log varnishcombined
	ServerSignature Off
</VirtualHost>
